<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í”„ë¦¬ë¯¸ì—„ ê´€ë¦¬ì ì§€ì›ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg,#030712,#09121d,#030712);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .wrapper { width: 100%; max-width: 540px; }
    .card {
      background: rgba(15,23,42,0.7);
      backdrop-filter: blur(14px);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 25px;
      animation: fadeIn .8s ease-out;
    }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(15px); }
      to { opacity:1; transform:translateY(0); }
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.4);
      margin-top: 6px;
      margin-bottom: 14px;
      background: rgba(15,23,42,0.8);
      color: #e5e7eb;
      outline: none;
      transition: .2s;
    }
    input:focus, textarea:focus {
      border-color: #22d3ee;
      box-shadow: 0 0 12px rgba(34,211,238,0.45);
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(120deg,#22d3ee,#a855f7,#f97316);
      background-size: 200% 200%;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: .3s;
      color: #0f172a;
    }
    button:hover { background-position: 100% 0; }

    #submitting-indicator { display:none; text-align:center; margin-top:10px; }
    #status-message { margin-top: 10px; font-size: 13px; min-height: 16px; }
    .status--success { color:#4ade80; }
    .status--error { color:#f87171; }
  </style>
</head>

<body>
  <main class="wrapper">
    <section class="card">
      <h2>í”„ë¦¬ë¯¸ì—„ ê´€ë¦¬ì ì§€ì›ì„œ</h2>

      <form id="application-form">
        <label>ë‚˜ì´ *</label>
        <input type="number" id="age" required>

        <label>ë””ìŠ¤ì½”ë“œ ë‹‰ë„¤ì„ *</label>
        <input type="text" id="discord" required>

        <label>í™œë™ ê°€ëŠ¥ ì‹œê°„ *</label>
        <input type="text" id="active_time" required>

        <label>ì§€ì› ë™ê¸° *</label>
        <textarea id="reason" required></textarea>

        <label>ê°ì˜¤ *</label>
        <textarea id="resolution" required></textarea>

        <label>ìš´ì˜ ê²½í—˜ *</label>
        <textarea id="operation_experience" required></textarea>

        <label>í•´í‚¹/ê°œë°œ ê²½í—˜ *</label>
        <textarea id="dev_experience" required></textarea>

        <button id="submit-button" onclick="finalSubmitCheck(event)">ì œì¶œí•˜ê¸°</button>

        <div id="submitting-indicator">ì œì¶œ ì¤‘ì…ë‹ˆë‹¤â€¦</div>
        <div id="status-message"></div>
      </form>

    </section>
  </main>

<script>
// =============================
// VPN ì‹¤ì‹œê°„ ê²€ì‚¬
// =============================
async function checkVPN() {
    try {
        const res = await fetch("/__check_vpn");
        const data = await res.json();
        if (data.vpn === "blocked") {
            window.location.href = "/vpn.html";
        }
    } catch (e) {}
}
setInterval(checkVPN, 5000);

// =============================
// ì œì¶œí•˜ê¸° ëˆŒë €ì„ ë•Œ ìµœì¢… ê²€ì‚¬
// =============================
async function finalSubmitCheck(event) {
    event.preventDefault();

    const res = await fetch("/__check_vpn");
    const data = await res.json();

    if (data.vpn === "blocked") {
        window.location.href = "/vpn.html";
        return;
    }

    // VPNì´ ì•„ë‹ˆë©´ í¼ ì œì¶œ ì‹¤í–‰
    document.getElementById("application-form").dispatchEvent(new Event("submit-real"));
}

// =============================
// Webhook ì œì¶œ ì²˜ë¦¬
// =============================
const WEBHOOK_URL =
  "https://discord.com/api/webhooks/1447521453145587733/HKUQbSR44_2R5CXrTEyuDoWpL8vtz9G4bdKT9BfoOOh5cPj22_ygwnG8Hz-heUC2Vrx4";

let userIp = "ì¡°íšŒ ì¤‘â€¦";
async function fetchUserIp() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    userIp = data.ip;
  } catch {
    userIp = "ì•Œ ìˆ˜ ì—†ìŒ";
  }
}
fetchUserIp();

function setStatus(msg, type = null) {
  const el = document.getElementById("status-message");
  el.textContent = msg;
  el.className = type ? "status--" + type : "";
}

async function sendWebhook(payload) {
  const res = await fetch(WEBHOOK_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  if (!res.ok) throw new Error("Webhook error");
}

document.getElementById("application-form").addEventListener("submit-real", async () => {
  const btn = document.getElementById("submit-button");
  const loader = document.getElementById("submitting-indicator");

  btn.disabled = true;
  loader.style.display = "block";
  setStatus("ì œì¶œ ì¤‘ì…ë‹ˆë‹¤â€¦");

  const payload = {
    embeds: [
      {
        title: "ğŸ“¥ ìƒˆ ê´€ë¦¬ì ì§€ì›ì„œê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤",
        color: 0xff0000, 
        fields: [
          { name: "ë‚˜ì´", value: age.value.trim(), inline: true },
          { name: "ë””ìŠ¤ì½”ë“œ ë‹‰ë„¤ì„", value: discord.value.trim(), inline: true },
          { name: "í™œë™ ê°€ëŠ¥ ì‹œê°„", value: active_time.value.trim() },
          { name: "ìš´ì˜ ê²½í—˜", value: operation_experience.value.trim() },
          { name: "ì§€ì› ë™ê¸°", value: reason.value.trim() },
          { name: "ê°ì˜¤", value: resolution.value.trim() },
          { name: "í•´í‚¹/ê°œë°œ ê²½í—˜", value: dev_experience.value.trim() }
        ],
        footer: { text: "ì‚¬ìš©ì IP: " + userIp },
        timestamp: new Date().toISOString()
      }
    ]
  };

  try {
    await sendWebhook(payload);
    setStatus("ì œì¶œ ì™„ë£Œ!", "success");
    document.getElementById("application-form").reset();
  } catch (e) {
    setStatus("ì˜¤ë¥˜ ë°œìƒ â€“ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.", "error");
  }

  loader.style.display = "none";
  btn.disabled = false;
});
</script>
</body>
</html>
